(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{369:function(t,v,_){"use strict";_.r(v);var a=_(39),e=Object(a.a)({},(function(){var t=this,v=t.$createElement,_=t._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"utau-渲染脚本"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#utau-渲染脚本"}},[t._v("#")]),t._v(" UTAU 渲染脚本")]),t._v(" "),_("p",[_("a",{attrs:{href:"https://ch.nicovideo.jp/delta_kimigatame/blomaga/ar429837",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文链接（日语）"),_("OutboundLink")],1),t._v(" 原作者："),_("a",{attrs:{href:"https://twitter.com/delta_kuro",target:"_blank",rel:"noopener noreferrer"}},[t._v("delta_kuro"),_("OutboundLink")],1)]),t._v(" "),_("hr"),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#utau-%E6%B8%B2%E6%9F%93%E8%84%9A%E6%9C%AC"}},[t._v("UTAU 渲染脚本")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#%E5%A3%B0%E6%98%8E"}},[t._v("声明")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#%E6%B8%B2%E6%9F%93%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BD%8D%E7%BD%AE"}},[t._v("渲染脚本的位置")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E5%A4%B9"}},[t._v("临时文件夹")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#%E8%84%9A%E6%9C%AC%E6%96%87%E4%BB%B6"}},[t._v("脚本文件")])])])]),t._v(" "),_("li",[_("a",{attrs:{href:"#%E6%B8%B2%E6%9F%93%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BD%9C%E7%94%A8"}},[t._v("渲染脚本的作用")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#%E5%8D%95%E6%A0%B8%E5%A4%84%E7%90%86"}},[t._v("单核处理")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#tempbat"}},[t._v("temp.bat")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#temp_helperbat"}},[t._v("temp_helper.bat")])])])]),t._v(" "),_("li",[_("a",{attrs:{href:"#%E5%A4%9A%E6%A0%B8%E5%A4%84%E7%90%86"}},[t._v("多核处理")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#tempbat-1"}},[t._v("temp.bat")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#%E5%85%B6%E4%BB%96%E6%89%B9%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6"}},[t._v("其他批处理文件")])])])])])]),t._v(" "),_("li",[_("a",{attrs:{href:"#%E6%B8%B2%E6%9F%93%E8%84%9A%E6%9C%AC%E7%9A%84%E5%86%85%E5%AE%B9"}},[t._v("渲染脚本的内容")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#tempbat-%E9%A1%B5%E9%A6%96"}},[t._v("temp.bat 页首")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#tempbat-%E6%AD%A3%E6%96%87"}},[t._v("temp.bat 正文")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#%E5%AF%B9%E4%BA%8E%E4%BC%91%E6%AD%A2%E7%AC%A6"}},[t._v("对于休止符")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#%E5%AF%B9%E4%BA%8E%E9%99%A4%E4%BC%91%E6%AD%A2%E7%AC%A6%E4%BB%A5%E5%A4%96%E7%9A%84%E9%9F%B3%E7%AC%A6"}},[t._v("对于除休止符以外的音符")])])])]),t._v(" "),_("li",[_("a",{attrs:{href:"#temp_helperbat-%E5%86%85%E5%AE%B9"}},[t._v("temp_helper.bat 内容")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#%E4%B8%8Eust%E6%97%A0%E5%85%B3%E7%9A%84%E6%8C%87%E4%BB%A4"}},[t._v("[与ust无关的指令]")])])])]),t._v(" "),_("li",[_("a",{attrs:{href:"#tempbat-%E9%A1%B5%E8%84%9A"}},[t._v("temp.bat 页脚")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#%E4%B8%8Eust%E6%97%A0%E5%85%B3%E7%9A%84%E6%8C%87%E4%BB%A4-1"}},[t._v("[与ust无关的指令]")])])])])])])])])]),t._v(" "),_("h2",{attrs:{id:"声明"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#声明"}},[t._v("#")]),t._v(" 声明")]),t._v(" "),_("p",[t._v("本文依据个人分析所写，因此可能存在少量不严谨。另外，翻译过程中补充了一些内容。")]),t._v(" "),_("h2",{attrs:{id:"渲染脚本的位置"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#渲染脚本的位置"}},[t._v("#")]),t._v(" 渲染脚本的位置")]),t._v(" "),_("h3",{attrs:{id:"临时文件夹"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#临时文件夹"}},[t._v("#")]),t._v(" 临时文件夹")]),t._v(" "),_("p",[t._v("一般地，UTAU 启动后，会在"),_("strong",[t._v("系统环境变量为 TEMP 的路径下")]),t._v("创建后台工作目录 "),_("code",[t._v("utauX")]),t._v("（X为正整数，由于utau可以多开，按启动顺序依次递增），用来存放合成脚本文件。")]),t._v(" "),_("p",[t._v("一般是这样一个文件夹："),_("code",[t._v("C:\\user\\<user名>\\AppData\\Local\\Temp\\utau1\\")])]),t._v(" "),_("h3",{attrs:{id:"脚本文件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#脚本文件"}},[t._v("#")]),t._v(" 脚本文件")]),t._v(" "),_("p",[t._v("一般会产生以下两个文件。")]),t._v(" "),_("ul",[_("li",[t._v("temp.bat")]),t._v(" "),_("li",[t._v("temp_helper.bat")])]),t._v(" "),_("p",[t._v("如果使用了 UTAU 的多核渲染，那么不会产生 helper，会产生以下文件，具体数量与线程数相同。")]),t._v(" "),_("ul",[_("li",[t._v("temp.bat")]),t._v(" "),_("li",[t._v("temp1.bat")]),t._v(" "),_("li",[t._v("temp2.bat")]),t._v(" "),_("li",[t._v("temp3.bat")]),t._v(" "),_("li",[t._v("...")])]),t._v(" "),_("h2",{attrs:{id:"渲染脚本的作用"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#渲染脚本的作用"}},[t._v("#")]),t._v(" 渲染脚本的作用")]),t._v(" "),_("h3",{attrs:{id:"单核处理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#单核处理"}},[t._v("#")]),t._v(" 单核处理")]),t._v(" "),_("h4",{attrs:{id:"temp-bat"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#temp-bat"}},[t._v("#")]),t._v(" temp.bat")]),t._v(" "),_("ul",[_("li",[t._v("从UTAU直接启动")]),t._v(" "),_("li",[t._v("将各种参数存在批处理的变量中")]),t._v(" "),_("li",[t._v("对于休止符，直接启动wavtool")])]),t._v(" "),_("h4",{attrs:{id:"temp-helper-bat"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#temp-helper-bat"}},[t._v("#")]),t._v(" temp_helper.bat")]),t._v(" "),_("ul",[_("li",[t._v("从temp.bat中启动")]),t._v(" "),_("li",[t._v("将temp.bat中设定的参数发送给resampler和wavtool")])]),t._v(" "),_("h3",{attrs:{id:"多核处理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#多核处理"}},[t._v("#")]),t._v(" 多核处理")]),t._v(" "),_("h4",{attrs:{id:"temp-bat-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#temp-bat-2"}},[t._v("#")]),t._v(" temp.bat")]),t._v(" "),_("ul",[_("li",[t._v("一次性调用合成器，在最后启动。")])]),t._v(" "),_("h4",{attrs:{id:"其他批处理文件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#其他批处理文件"}},[t._v("#")]),t._v(" 其他批处理文件")]),t._v(" "),_("ul",[_("li",[t._v("在合成开始后同时启动重采样器，并行进程。")]),t._v(" "),_("li",[t._v("所有进程结束后启动 "),_("code",[t._v("temp.bat")]),t._v("。")])]),t._v(" "),_("p",[_("strong",[t._v("本文只讨论单核渲染的批处理文件。")])]),t._v(" "),_("h2",{attrs:{id:"渲染脚本的内容"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#渲染脚本的内容"}},[t._v("#")]),t._v(" 渲染脚本的内容")]),t._v(" "),_("h3",{attrs:{id:"temp-bat-页首"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#temp-bat-页首"}},[t._v("#")]),t._v(" temp.bat 页首")]),t._v(" "),_("p",[_("strong",[t._v("@rem project")]),_("br"),t._v("\n工程文件名")]),t._v(" "),_("p",[_("strong",[t._v("@set loadmodule")]),_("br"),t._v("\n模块的设定？似乎一直是空白的")]),t._v(" "),_("p",[_("strong",[t._v("@set tempo")]),_("br"),t._v("\n工程曲速")]),t._v(" "),_("p",[_("strong",[t._v("@set samples")]),_("br"),t._v("\n采样频率")]),t._v(" "),_("p",[_("strong",[t._v("@set oto")]),_("br"),t._v("\n音源文件夹的完整路径")]),t._v(" "),_("p",[_("strong",[t._v("@set tool")]),_("br"),t._v("\n合成引擎 (wavtool)的完整路径")]),t._v(" "),_("p",[_("strong",[t._v("@set resamp")]),_("br"),t._v("\n重采样引擎(resampler) 的完整路径")]),t._v(" "),_("p",[_("strong",[t._v("@set output")]),_("br"),t._v("\ntemp.wav的相对路径")]),t._v(" "),_("p",[_("strong",[t._v("@set helper")]),_("br"),t._v("\ntemp_helper.bat的路径")]),t._v(" "),_("p",[_("strong",[t._v("@set cachedir")]),_("br"),t._v("\n缓存文件夹的路径")]),t._v(" "),_("p",[_("strong",[t._v("@set flag")]),_("br"),t._v("\n全局Flags")]),t._v(" "),_("p",[_("strong",[t._v("@set env")]),_("br"),t._v("\n默认音量包络")]),t._v(" "),_("p",[_("strong",[t._v("@set stp")]),_("br"),t._v("\n定义变量stp")]),t._v(" "),_("p",[_("strong",[t._v('@del "%output%" 2>nul')]),_("br"),t._v("\n如果temp.wav存在，则将它删掉"),_("br"),t._v('\n"2>nul"指的是不输出错误信息')]),t._v(" "),_("p",[_("strong",[t._v('@mkdir "%cachedir%" 2>nul')]),_("br"),t._v("\n创建缓存文件夹")]),t._v(" "),_("h3",{attrs:{id:"temp-bat-正文"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#temp-bat-正文"}},[t._v("#")]),t._v(" temp.bat 正文")]),t._v(" "),_("h4",{attrs:{id:"对于休止符"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#对于休止符"}},[t._v("#")]),t._v(" 对于休止符")]),t._v(" "),_("p",[_("strong",[t._v('@"%tool%" "%output%""%oto%\\R.wav" 0 480@120+0.0 0 0')]),_("br"),t._v("\n直接调用wavtool")]),t._v(" "),_("blockquote",[_("ul",[_("li",[t._v("第一个参数：输出文件")]),t._v(" "),_("li",[t._v("第二个参数：在原音设定文件夹下的R.wav"),_("code",[t._v("（似乎用这个来识别休止符）")])]),t._v(" "),_("li",[t._v("第三个参数：stp"),_("code",[t._v("（休止符为0）")])]),t._v(" "),_("li",[t._v("第四个参数：输出的实际长度\n"),_("ul",[_("li",[t._v("格式：音长@tempo+校正值")]),t._v(" "),_("li",[t._v("校正值 = 先行声音（校正后）+ 末端偏移"),_("br"),t._v("\n详见 "),_("RouterLink",{attrs:{to:"/developers/UTAU-Backend/Length-Correction.html#音符实际长度与二次校正"}},[t._v("咬合校正")])],1)])]),t._v(" "),_("li",[t._v("第五个参数（以及后面一堆）：音量包络"),_("code",[t._v("（对于休止符:0 0）")])])])]),t._v(" "),_("h4",{attrs:{id:"对于除休止符以外的音符"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#对于除休止符以外的音符"}},[t._v("#")]),t._v(" 对于除休止符以外的音符")]),t._v(" "),_("p",[_("strong",[t._v("@set params=100 0 !120 AA#5#　"),_("code",[t._v("[必填]")])]),_("br"),t._v("\n设定音调参数")]),t._v(" "),_("blockquote",[_("ul",[_("li",[t._v("第一个参数：音量")]),t._v(" "),_("li",[t._v("第二个参数：移调")]),t._v(" "),_("li",[t._v("第三个参数：曲速"),_("code",[t._v("（格式：!tempo）")])]),t._v(" "),_("li",[t._v("第四个参数：音高曲线字符串")])])]),t._v(" "),_("p",[_("strong",[t._v('@set flag="g5"')]),_("br"),t._v("\n设定 Flags")]),t._v(" "),_("blockquote",[_("ul",[_("li",[t._v("一般是全局flags在后，音符flags在前")]),t._v(" "),_("li",[t._v("出现同一个参数时，只有第一个有效")]),t._v(" "),_("li",[t._v("当出现 e 或者 E 时，在前面添加反斜杠")])])]),t._v(" "),_("p",[_("strong",[t._v("@set env=0 5 35 0 100 100 0 70 0 10 100 "),_("code",[t._v("[必填]")])]),_("br"),t._v("\n音量包络"),_("code",[t._v("（除了休止符，有三种格式，任选其一）")])]),t._v(" "),_("blockquote",[_("ul",[_("li",[t._v("p1 p2 p3 v1 v2 v3 v4 ove")]),t._v(" "),_("li",[t._v("p1 p2 p3 v1 v2 v3 v4 ove p4")]),t._v(" "),_("li",[t._v("p1 p2 p3 v1 v2 v3 v4 ove p4 p5 v5")])])]),t._v(" "),_("p",[_("strong",[t._v("@set stp=150")]),_("br"),t._v("\n设定 stp 数值")]),t._v(" "),_("p",[_("strong",[t._v("@set vel=100"),_("code",[t._v("【必填】")])]),_("br"),t._v("\n辅音速度")]),t._v(" "),_("p",[_("strong",[t._v('@set temp="%cachedir%\\1_あ_C4_OkgOOW.wav"'),_("code",[t._v("【必填】")])]),_("br"),t._v("\n缓存文件的路径")]),t._v(" "),_("blockquote",[_("ul",[_("li",[t._v("文件名是 "),_("code",[t._v("[ust音符序号]_[歌词]_[音阶]_[六位英文数字].wav")])]),t._v(" "),_("li",[t._v("歌词中的"),_("code",[t._v("半角空格")]),t._v("会被替换为"),_("code",[t._v("“+”")]),t._v("，"),_("code",[t._v("“*”")]),t._v("替换为"),_("code",[t._v("“$”")]),t._v("，"),_("code",[t._v("“?”")]),t._v("替换为"),_("code",[t._v("“=”")]),t._v("，"),_("code",[t._v("正反斜杠")]),t._v("替换为"),_("code",[t._v("下划线")]),t._v("，其他文件名敏感符号直接忽略。")]),t._v(" "),_("li",[t._v("乱码后缀意义不明（可能是随机生成）")]),t._v(" "),_("li",[t._v("当对同一个音符进行操作后，通过改变文件名来区分缓存，这种方法比较好。")])])]),t._v(" "),_("p",[_("strong",[t._v("@echo ##########------------------------------(1/4)"),_("code",[t._v("【必填】")])]),_("br"),t._v("\n显示合成进度")]),t._v(" "),_("p",[_("strong",[t._v('@call %helper% "%oto%_おおうえあ.wav" C4 480@120+70.0 30 3170.884 600 50.0 -1169.19 0'),_("code",[t._v("【必填】")])]),_("br"),t._v("\ntemp_helper.bat的启动指令")]),t._v(" "),_("blockquote",[_("ul",[_("li",[t._v('第1个参数：采样的文件名("%oto%\\あ.wav")')]),t._v(" "),_("li",[t._v("第2个参数：渲染目标音阶名(C4)")]),t._v(" "),_("li",[t._v("第3个参数：音符长度(与休止符相同)(480@120+70.0)")]),t._v(" "),_("li",[t._v("第4个参数：先行发声(30)")]),t._v(" "),_("li",[t._v("第5个参数：偏移(3170.884)")]),t._v(" "),_("li",[t._v("第6个参数：resampler输出的声音长度(600)\n"),_("ul",[_("li",[t._v("与wavtool结合前，没有经过裁剪直接输出的长度")]),t._v(" "),_("li",[t._v("（第3个参数换算为ms后的长度+stp）/50，四舍五入以后再乘以50")])])]),t._v(" "),_("li",[t._v("第7个参数 固定范围(50.0)")]),t._v(" "),_("li",[t._v("第8个参数 右侧空白(-1169.19)")]),t._v(" "),_("li",[t._v("第9个参数 序号(0)\n"),_("ul",[_("li",[t._v("多线程合成时这个参数如果错误可能引起问题")])])])])]),t._v(" "),_("h3",{attrs:{id:"temp-helper-bat-内容"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#temp-helper-bat-内容"}},[t._v("#")]),t._v(" temp_helper.bat 内容")]),t._v(" "),_("h4",{attrs:{id:"与ust无关的指令"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#与ust无关的指令"}},[t._v("#")]),t._v(" [与ust无关的指令]")]),t._v(" "),_("p",[_("strong",[t._v("@if exist %temp%goto A")]),_("br"),t._v("\n如果存在缓存文件，那么跳过重采样步骤")]),t._v(" "),_("p",[_("strong",[t._v('@if exist"%cachedir%%9_'),_("em",[t._v('.wav" del "%cachedir%%9_')]),t._v('.wav"')]),_("br"),t._v("\n如果有相同序号但不同名称的文件，则删除")]),t._v(" "),_("p",[_("strong",[t._v('@"%resamp%"%1 %temp% %2 %vel% %flag% %5 %6 %7 %8 %params%')]),_("br"),t._v("\n启动重采样引擎（之前已经讲过）")]),t._v(" "),_("p",[_("strong",[t._v(":A")]),_("br"),t._v("\n提供给第一行跳跃的标签")]),t._v(" "),_("p",[_("strong",[t._v('@"%tool%""%output%" %temp% %stp% %3 %env%')]),_("br"),t._v("\n启动合成引擎（与休止符一样）")]),t._v(" "),_("h3",{attrs:{id:"temp-bat-页脚"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#temp-bat-页脚"}},[t._v("#")]),t._v(" temp.bat 页脚")]),t._v(" "),_("h4",{attrs:{id:"与ust无关的指令-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#与ust无关的指令-2"}},[t._v("#")]),t._v(" [与ust无关的指令]")]),t._v(" "),_("p",[_("strong",[t._v('@if not exist"%output%.whd" goto E')]),_("br"),t._v(" "),_("strong",[t._v('@if not exist"%output%.dat" goto E')]),_("br"),t._v("\n检查是否生成了 temp.whd 和 temp.dat。如果没有，跳过以下步骤。")]),t._v(" "),_("blockquote",[_("p",[t._v("当temp_helper.bat正在被调用时，还没有生成temp.wav，temp.whd与temp.dat已经生成了。")])]),t._v(" "),_("p",[_("strong",[t._v('copy /Y"%output%.whd" /B + "%output%.dat" /B "%output%"')]),_("br"),t._v("\n将 temp.whd 和 temp.dat 合并为 temp.wav。")]),t._v(" "),_("blockquote",[_("p",[t._v("#whd可能是 "),_("code",[t._v("wav head")]),t._v(" 的意思。")])]),t._v(" "),_("p",[_("strong",[t._v('del "%output%.whd"')]),_("br"),t._v(" "),_("strong",[t._v('del"%output%.dat"')]),_("br"),t._v("\n删除temp.whd与temp.dat。")]),t._v(" "),_("p",[_("strong",[t._v(":E")]),_("br"),t._v("\n跳过合并与删除过程的标签。")])])}),[],!1,null,null,null);v.default=e.exports}}]);